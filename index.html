<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Recruitment Form</title>
  <style>
    body { font-family: system-ui, sans-serif; max-width: 720px; margin: 40px auto; padding: 0 16px; }
    form { display: grid; gap: 12px; }
    .row { display: grid; gap: 12px; grid-template-columns: 1fr 1fr; }
    input, select, textarea, button { padding: 10px; font-size: 16px; }
    button { cursor: pointer; }
    .note { color:#666; font-size: 14px; }
    .hidden { display:none; }
  </style>
</head>
<body>
  <h1>Apply for a Role</h1>
  <p class="note">All fields are required.</p>

  <form id="applyForm">
    <div class="row">
      <input name="full_name" placeholder="Full name" required />
      <input type="email" name="email" placeholder="you@example.com" required />
    </div>

    <div class="row">
      <input type="number" name="age" placeholder="Age" min="16" required />
      <input name="location" placeholder="City, Country" required />
    </div>

    <!-- Skills dropdown (single select; pick one core skill) -->
    <label>Primary Skill (choose one)</label>
    <select name="skill" required>
      <option value="" selected disabled>-- Select a primary skill --</option>
      <option>Frontend</option>
      <option>Backend</option>
      <option>DevOps</option>
      <option>Data</option>
      <option>Design</option>
      <option>QA</option>
      <option>Product Management</option>
      <option>Sales</option>
      <option>Support</option>
      <option>Operations</option>
    </select>

    <!-- Languages (multi-select checkboxes) -->
    <fieldset>
      <legend>Languages (select all that apply)</legend>
      <label><input type="checkbox" name="languages" value="English" required /> English</label>
      <label><input type="checkbox" name="languages" value="Arabic" /> Arabic</label>
      <label><input type="checkbox" name="languages" value="French" /> French</label>
      <label><input type="checkbox" name="languages" value="Spanish" /> Spanish</label>
      <label><input type="checkbox" name="languages" value="German" /> German</label>
    </fieldset>

    <div class="row">
      <input type="number" name="experience_years" placeholder="Years of experience" min="0" step="0.5" required />
      <input name="client_id" value="recruit-form-001" required />
    </div>

    <!-- Honeypot -->
    <input type="text" name="company" class="hidden" autocomplete="off" tabindex="-1" />

    <button type="submit">Submit Application</button>
    <div id="result" class="note"></div>
  </form>

  <script>
    const WEBHOOK = "https://msnabil3.app.n8n.cloud/webhook-test/order-form-website-inventory" method="POST"; // <--- CHANGE THIS

    const form = document.getElementById("applyForm");
    const result = document.getElementById("result");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const data = new FormData(form);

      // spam trap
      if ((data.get("company") || "").trim() !== "") {
        result.textContent = "Thanks!";
        form.reset();
        return;
      }

      // collect checked languages
      const langs = [];
      for (const el of form.querySelectorAll('input[name="languages"]:checked')) {
        langs.push(el.value);
      }

      const payload = {
        full_name: (data.get("full_name") || "").trim(),
        email: (data.get("email") || "").trim().toLowerCase(),
        age: Number(data.get("age")),
        location: (data.get("location") || "").trim(),
        skill: data.get("skill"),
        languages: langs,
        experience_years: Number(data.get("experience_years")),
        client_id: (data.get("client_id") || "recruit-form-001").trim(),
        metadata: { source: "recruitment-form" }
      };

      result.textContent = "Submittingâ€¦";

      try {
        const res = await fetch(WEBHOOK, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });
        const json = await res.json().catch(() => ({}));
        if (res.ok) {
          result.textContent = json.status ? `Done: ${json.status}` : "Submitted!";
          form.reset();
        } else {
          result.textContent = `Error: ${json.message || res.status}`;
        }
      } catch (err) {
        result.textContent = "Network error. Please try again.";
      }
    });
  </script>
</body>
</html>
